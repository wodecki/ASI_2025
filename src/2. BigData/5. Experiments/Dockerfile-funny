FROM python:3.11-slim

# Copy uv for dependency management
COPY --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/uv

WORKDIR /app

# Copy dependencies first (for layer caching)
COPY pyproject.toml ./
RUN uv sync --no-dev

# Copy application
COPY app-funny.py ./app.py

# Port is set dynamically by Cloud Run via $PORT env var
EXPOSE 8080

# Streamlit configuration for Cloud Run
ENV STREAMLIT_SERVER_PORT=8080
ENV STREAMLIT_SERVER_ADDRESS=0.0.0.0
ENV STREAMLIT_SERVER_HEADLESS=true
ENV STREAMLIT_SERVER_ENABLE_CORS=false
ENV STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=false

CMD ["uv", "run", "streamlit", "run", "app.py"]
